<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>使用指南 | QuickShare</title>
    <meta name="description" content="快享前端开发团队技能分享记录">
    <link rel="icon" href="/favicon.ico">
    
    <link rel="preload" href="/assets/css/0.styles.6a0a910a.css" as="style"><link rel="preload" href="/assets/js/app.9793175a.js" as="script"><link rel="preload" href="/assets/js/2.57fa4a44.js" as="script"><link rel="preload" href="/assets/js/20.cc05a5ea.js" as="script"><link rel="preload" href="/assets/js/11.1b48c078.js" as="script"><link rel="preload" href="/assets/js/7.5691be78.js" as="script"><link rel="prefetch" href="/assets/js/10.22aa0559.js"><link rel="prefetch" href="/assets/js/12.23b41acf.js"><link rel="prefetch" href="/assets/js/13.e6f1d33f.js"><link rel="prefetch" href="/assets/js/14.21d1240e.js"><link rel="prefetch" href="/assets/js/15.31ac8905.js"><link rel="prefetch" href="/assets/js/16.d8710790.js"><link rel="prefetch" href="/assets/js/17.7c16c093.js"><link rel="prefetch" href="/assets/js/18.b3c8066f.js"><link rel="prefetch" href="/assets/js/19.321a1186.js"><link rel="prefetch" href="/assets/js/21.706cc565.js"><link rel="prefetch" href="/assets/js/22.f4e4d8df.js"><link rel="prefetch" href="/assets/js/23.59752c09.js"><link rel="prefetch" href="/assets/js/24.e64a7690.js"><link rel="prefetch" href="/assets/js/25.3bf68b15.js"><link rel="prefetch" href="/assets/js/26.dfae6884.js"><link rel="prefetch" href="/assets/js/27.b422b1de.js"><link rel="prefetch" href="/assets/js/28.ddeacb68.js"><link rel="prefetch" href="/assets/js/29.4d2cd2da.js"><link rel="prefetch" href="/assets/js/3.d7f8ab62.js"><link rel="prefetch" href="/assets/js/30.79c2a944.js"><link rel="prefetch" href="/assets/js/31.b7c54908.js"><link rel="prefetch" href="/assets/js/32.e7963125.js"><link rel="prefetch" href="/assets/js/33.110f59a8.js"><link rel="prefetch" href="/assets/js/34.d1e74998.js"><link rel="prefetch" href="/assets/js/35.c472e54f.js"><link rel="prefetch" href="/assets/js/36.8e62066a.js"><link rel="prefetch" href="/assets/js/37.470102fd.js"><link rel="prefetch" href="/assets/js/38.4ef1d79e.js"><link rel="prefetch" href="/assets/js/39.2d3fb403.js"><link rel="prefetch" href="/assets/js/4.21a58a49.js"><link rel="prefetch" href="/assets/js/40.9c17d6b7.js"><link rel="prefetch" href="/assets/js/41.f53f1a2f.js"><link rel="prefetch" href="/assets/js/42.6b0bae7c.js"><link rel="prefetch" href="/assets/js/43.96cebf3d.js"><link rel="prefetch" href="/assets/js/44.1baf9486.js"><link rel="prefetch" href="/assets/js/45.671f205a.js"><link rel="prefetch" href="/assets/js/46.55a42814.js"><link rel="prefetch" href="/assets/js/47.ed27fe3d.js"><link rel="prefetch" href="/assets/js/48.5fe76300.js"><link rel="prefetch" href="/assets/js/49.e36fff0f.js"><link rel="prefetch" href="/assets/js/5.e372fd51.js"><link rel="prefetch" href="/assets/js/50.61d8b2a2.js"><link rel="prefetch" href="/assets/js/51.0daba9bb.js"><link rel="prefetch" href="/assets/js/52.d0a0ef22.js"><link rel="prefetch" href="/assets/js/53.a8b9a2b9.js"><link rel="prefetch" href="/assets/js/54.c7a74071.js"><link rel="prefetch" href="/assets/js/55.84e3ebd9.js"><link rel="prefetch" href="/assets/js/56.e9f9748f.js"><link rel="prefetch" href="/assets/js/6.35303bef.js"><link rel="prefetch" href="/assets/js/8.552bd3b2.js"><link rel="prefetch" href="/assets/js/9.c1b7fe2f.js">
    <link rel="stylesheet" href="/assets/css/0.styles.6a0a910a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/images/logo_c.png" alt="QuickShare" class="logo"> <span class="site-name can-hide">QuickShare</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="/knowledge/" class="nav-link">Share</a></div><div class="nav-item"><a href="/baseComponents/" class="nav-link">Components</a></div><div class="nav-item"><a href="/aboutWebpack/" class="nav-link">Webpack</a></div><div class="nav-item"><a href="/autoTesting/" class="nav-link router-link-active">UnitTesting</a></div><div class="nav-item"><a href="/frame/" class="nav-link">Frame</a></div><div class="nav-item"><a href="/utils/" class="nav-link">Utils</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="/knowledge/" class="nav-link">Share</a></div><div class="nav-item"><a href="/baseComponents/" class="nav-link">Components</a></div><div class="nav-item"><a href="/aboutWebpack/" class="nav-link">Webpack</a></div><div class="nav-item"><a href="/autoTesting/" class="nav-link router-link-active">UnitTesting</a></div><div class="nav-item"><a href="/frame/" class="nav-link">Frame</a></div><div class="nav-item"><a href="/utils/" class="nav-link">Utils</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>单元测试</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/autoTesting/" class="sidebar-link">介绍</a></li><li><a href="/autoTesting/guid.html" class="active sidebar-link">使用指南</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/autoTesting/guid.html#优势" class="sidebar-link">优势</a></li><li class="sidebar-sub-header"><a href="/autoTesting/guid.html#命令行" class="sidebar-link">命令行</a></li><li class="sidebar-sub-header"><a href="/autoTesting/guid.html#unit-测试" class="sidebar-link">unit 测试</a></li><li class="sidebar-sub-header"><a href="/autoTesting/guid.html#e2e-测试" class="sidebar-link">e2e 测试</a></li><li class="sidebar-sub-header"><a href="/autoTesting/guid.html#起步" class="sidebar-link">起步</a></li><li class="sidebar-sub-header"><a href="/autoTesting/guid.html#jest-配置文件" class="sidebar-link">jest 配置文件</a></li><li class="sidebar-sub-header"><a href="/autoTesting/guid.html#测试覆盖率报告" class="sidebar-link">测试覆盖率报告</a></li></ul></li><li><a href="/autoTesting/skill.html" class="sidebar-link">使用技巧</a></li><li><a href="/autoTesting/api.html" class="sidebar-link">API</a></li><li><a href="/autoTesting/wrapper.html" class="sidebar-link">Wrapper</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><!----> <h1 id="使用指南"><a href="#使用指南" aria-hidden="true" class="header-anchor">#</a> 使用指南</h1> <p>按空间切割，对每个组件进行测试</p> <h2 id="优势"><a href="#优势" aria-hidden="true" class="header-anchor">#</a> 优势</h2> <ul><li>不用在修改代码之后提心吊胆的等着浏览器刷新。</li> <li>修改一小部分代码，就可以模拟上下文，调试一个片段。</li> <li>运行速度也比编译整个项目快得多。</li> <li>如果一次没改好，也不用重复操作。</li> <li>测试用例当作调试用的。一边写代码，一边写测试用例。</li></ul> <div class="danger custom-block"><p>注意事项：如果项目已经完成，一般不推荐使用测试用例，主要用于开发阶段的测试。</p></div> <h2 id="命令行"><a href="#命令行" aria-hidden="true" class="header-anchor">#</a> 命令行</h2> <p>在 package.json 文件中可以看到两个命令 e2e unit</p> <br> <div class="image-view"><div class="image-content image-small"><img alt="命令行" title="命令行" src="/images/autoTesting/002.jpg"> <!----></div></div> <br> <p><strong>npm run unit</strong>：这是我们使用的命令，站在程序员的角度测试。
<br></p> <p><strong>npm run e2e</strong>：这是站在用户角度的测试。</p> <h2 id="unit-测试"><a href="#unit-测试" aria-hidden="true" class="header-anchor">#</a> unit 测试</h2> <p>按空间切割，对每个组件进行测试。<a href="/autoTesting/guid.html#起步" title="unit测试">unit测试</a> <br>
程序员写好自己的逻辑后可以很容易的测试自己的逻辑返回的是不是都正确。
<br>
比如，我要测试日期输入框，那么我编写的测试用例应该包括以下部分：</p> <ul><li>默认日期是否为当天</li> <li>当用户选择日期范围，data是否会做相应改变</li></ul> <h2 id="e2e-测试"><a href="#e2e-测试" aria-hidden="true" class="header-anchor">#</a> e2e 测试</h2> <p>按时间切割，对每个流程进行测试。
<br>
测试所有的需求是不是都可以正确的完成，而且最终要的是在代码重构，js改动很多之后，需要对需求进行测试的时候测试代码是不需要改变的，你也不用担心在重构后不能达到客户的需求。
<br>
比如，我要测试搜索功能，那么我编写的测试用例应该模拟以下步骤：</p> <ul><li>打开主页</li> <li>点击菜单跳转到详情页</li> <li>输入搜索条件</li> <li>点击搜索查看搜索结果是否与预期一致</li></ul> <h2 id="起步"><a href="#起步" aria-hidden="true" class="header-anchor">#</a> 起步</h2> <p>使用 jest 和 @vue/test-utils 的方式进行单元测试，结合 <a href="https://vue-test-utils.vuejs.org/zh/api/" title="单元测试Api" target="_blank" rel="noopener noreferrer">单元测试Api<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 和 <a href="https://vue-test-utils.vuejs.org/zh/api/wrapper/" title="wrapper方法" target="_blank" rel="noopener noreferrer">wrapper方法<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 书写断言</p> <h3 id="新项目中使用"><a href="#新项目中使用" aria-hidden="true" class="header-anchor">#</a> 新项目中使用</h3> <p>Step 1：初始化项目，在选择是否使用的 test 的时候选择 jest 即可</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>  vue init webpack my-project 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Step 2：安装 @vue/test-utils 依赖</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>  <span class="token function">npm</span> <span class="token function">install</span> @vue/test-utils --save
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Step 3：在 src/components/HelloWorld.vue 文件中写待测试代码，以下代码是点击自增的功能。</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>count<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>{{ count }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>increment<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>点击自增<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
      name<span class="token punctuation">:</span> <span class="token string">'HelloWorld'</span><span class="token punctuation">,</span>

      <span class="token function">data</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
          count<span class="token punctuation">:</span> <span class="token number">0</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>

      methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token function-variable function">increment</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>count<span class="token operator">++</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>Step 4：测试断言，用于写测试用例，主要是测试哪些内容，以及测试结果的预期。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>  <span class="token comment">// 从测试实用工具集中导入 `mount()` 方法</span>
  <span class="token keyword">import</span> <span class="token punctuation">{</span> mount <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@vue/test-utils'</span>
  <span class="token comment">// 导入你要测试的组件</span>
  <span class="token keyword">import</span> HelloWorld <span class="token keyword">from</span> <span class="token string">'@/components/HelloWorld'</span>

  <span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'HelloWorld.vue'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 挂载组件，得到其包裹器</span>
  <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">mount</span><span class="token punctuation">(</span>HelloWorld<span class="token punctuation">)</span>

  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'标记语言是否正确渲染'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toContain</span><span class="token punctuation">(</span><span class="token string">'&lt;span class=&quot;count&quot;&gt;0&lt;/span&gt;'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'是否存在一个按钮'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'检查点击事件是否正确'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 初始是否 0</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>count<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> button <span class="token operator">=</span> wrapper<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">)</span>
    <span class="token comment">// 模拟用户点击</span>
    button<span class="token punctuation">.</span><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>count<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><p>Step 5：输出结果 npm run unit</p> <div class="image-view"><div class="image-content image-small"><img alt="输出结果" title="输出结果" src="/images/autoTesting/001.jpg"> <!----></div></div> <p>运行以后会生成一个<a href="/autoTesting/guid.html#测试覆盖率报告" title="测试覆盖率报告">测试覆盖率报告</a>，通过分析未被测试覆盖的代码，找到是设计问题，还功能理解有问题，还是说着就是一段废代码，它可以帮助开发者能够更好的理解背后的事情，可以检查程序中的废代码，然后在以后的设计中做很好的抽象，做可测试的代码。</p> <h3 id="已存在项目中使用"><a href="#已存在项目中使用" aria-hidden="true" class="header-anchor">#</a> 已存在项目中使用</h3> <p>Step 1：首先需要在 package.json 中配置</p> <div class="image-view"><div class="image-content image-small"><img alt="配置" title="配置" src="/images/autoTesting/003.jpg"> <!----></div></div> <p>Step 2：npm install 或者 cnpm install 安装依赖</p> <div class="danger custom-block"><p>注意事项：不建议在已存在的项目中添加单元测试，会存在版本不兼容的问题。</p></div> <h3 id="安装过程中出现的问题"><a href="#安装过程中出现的问题" aria-hidden="true" class="header-anchor">#</a> 安装过程中出现的问题</h3> <ul><li><strong>提示：SecurityError: localstorage is not available for opaque origins</strong></li></ul> <div class="image-view"><div class="image-content image-small"><img alt="问题" title="问题" src="/images/autoTesting/004.jpg"> <!----></div></div> <div class="warning custom-block"><p>解决方法：test/unit/jest.conf.js 文件配置，添加两项配置参数</p></div> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>  verbose: true,
  testURL: <span class="token string">&quot;http://localhost/&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li><strong>提示：Option &quot;mapCoverage&quot; has been removed, as it's no longer necessary</strong></li></ul> <div class="image-view"><div class="image-content image-small"><img alt="问题" title="问题" src="/images/autoTesting/005.jpg"> <!----></div></div> <div class="warning custom-block"><p>解决方法：test/unit/jest.conf.js 文件配置，去掉 mapCoverage: true</p></div> <h2 id="jest-配置文件"><a href="#jest-配置文件" aria-hidden="true" class="header-anchor">#</a> jest 配置文件</h2> <p>jest的配置文件是单独生成在unit文件夹下的一个独立文件，并没有和vue-cli生成的webpack构建的环境相关联。可以详见 <a href="https://jestjs.io/docs/en/configuration" title="jest官网配置" target="_blank" rel="noopener noreferrer">jest官网配置<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>  <span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>

  module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>

    <span class="token comment">// 整个项目的根目录</span>
    rootDir<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../../'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

    <span class="token comment">// 让 jest 知道你需要测试覆盖的文件的扩展名都是什么</span>
    moduleFileExtensions<span class="token punctuation">:</span> <span class="token punctuation">[</span>
      <span class="token string">'js'</span><span class="token punctuation">,</span>
      <span class="token string">'json'</span><span class="token punctuation">,</span>
      <span class="token string">'vue'</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>

    <span class="token comment">// 通过该参数，可以 mock 一些图片、css等静态文件</span>
    moduleNameMapper<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token string">'^@/(.*)$'</span><span class="token punctuation">:</span> <span class="token string">'&lt;rootDir&gt;/src/$1'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    <span class="token comment">// 转换器：通过正则来匹配文件，为匹配到的文件使用对应的模版</span>
    transform<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token string">'^.+\\.js$'</span><span class="token punctuation">:</span> <span class="token string">'&lt;rootDir&gt;/node_modules/babel-jest'</span><span class="token punctuation">,</span>
      <span class="token string">'.*\\.(vue)$'</span><span class="token punctuation">:</span> <span class="token string">'&lt;rootDir&gt;/node_modules/vue-jest'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    <span class="token comment">// 在执行测试之前与所有测试路径匹配的正则表达式模式字符串数组。</span>
    <span class="token comment">// 如果测试路径与任何模式匹配，则将跳过它。</span>
    testPathIgnorePatterns<span class="token punctuation">:</span> <span class="token punctuation">[</span>
      <span class="token string">'&lt;rootDir&gt;/test/e2e'</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>

    <span class="token comment">// 快照测试的插件，会生成测试文件的一个快照版本，</span>
    <span class="token comment">// 可以再package.json中查看安装的快照插件。</span>
    snapshotSerializers<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'&lt;rootDir&gt;/node_modules/jest-serializer-vue'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>

    <span class="token comment">// 运行一些测试环境所要依赖的模块的路径列表，</span>
    <span class="token comment">// 比如引入vue，elementUI等插件的列表，以给测试提供完整的环境。</span>
    setupFiles<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'&lt;rootDir&gt;/test/unit/setup'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>

    <span class="token comment">// 是否收集测试时的覆盖率信息，默认 false</span>
    collectCoverage<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>

    <span class="token comment">// jest输出覆盖率信息文件的目录。</span>
    coverageDirectory<span class="token punctuation">:</span> <span class="token string">'&lt;rootDir&gt;/test/unit/coverage'</span><span class="token punctuation">,</span>

    <span class="token comment">// 为数组中匹配的文件收集覆盖率信息，即使并没有为该文件写相关的测试代码，</span>
    <span class="token comment">// 需要将collectCoverage设置为true，或者通过--corverage参数来调用jest。</span>
    collectCoverageFrom<span class="token punctuation">:</span> <span class="token punctuation">[</span>
      <span class="token string">'src/**/*.{js,vue}'</span><span class="token punctuation">,</span>
      <span class="token string">'!src/main.js'</span><span class="token punctuation">,</span>
      <span class="token string">'!src/router/index.js'</span><span class="token punctuation">,</span>
      <span class="token string">'!**/node_modules/**'</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token comment">// 指示是否应在运行期间报告每个单独的测试。执行后，所有错误仍将显示在底部。</span>
    verbose<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>

    <span class="token operator">/</span><span class="token operator">/</span> 设置jsdom环境的参数
    testURL<span class="token punctuation">:</span> <span class="token string">&quot;http://localhost/&quot;</span>
  <span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br></div></div><h2 id="测试覆盖率报告"><a href="#测试覆盖率报告" aria-hidden="true" class="header-anchor">#</a> 测试覆盖率报告</h2> <h3 id="测试覆盖率报告定义"><a href="#测试覆盖率报告定义" aria-hidden="true" class="header-anchor">#</a> 测试覆盖率报告定义</h3> <p>如果完全通过测试覆盖作为质量标准是存在问题的，我们在检查一个测试覆盖了的时候往往会通过一些工具去检查，程序员是可以通过一些方式让数字看上去漂亮，但是这没有意义。我们应该把它作为一种发现未被测试覆盖的代码的手段，同时也是一种学习的手段，为什么这段代码没有覆盖到？ 如果这个函数的参数发生了变化会怎么样？ 这段代码逻辑怎么这么复杂？</p> <blockquote><p>这里所说的测试覆盖率，开发人员写的单元测试的覆盖率，不是测试人员的功能测试的覆盖率。</p></blockquote> <h3 id="覆盖率报告路径"><a href="#覆盖率报告路径" aria-hidden="true" class="header-anchor">#</a> 覆盖率报告路径</h3> <p>在 test\unit\coverage\lcov-report 中有一个 index.html 文件，这是打开的一个生成 html 格式的测试报告：</p> <div class="image-view"><div class="image-content image-small"><img alt="测试覆盖率报告" title="测试覆盖率报告" src="/images/autoTesting/006.jpg"> <!----></div></div> <h3 id="覆盖率的四个指标"><a href="#覆盖率的四个指标" aria-hidden="true" class="header-anchor">#</a> 覆盖率的四个指标</h3> <ul><li><p>从图中我们可以看到它有四个指标：</p> <ul><li>Statements: 语句覆盖率，执行到每个语句；</li> <li>Branches: 分支覆盖率，执行到每个if代码块；</li> <li>Functions: 函数覆盖率，调用到程式中的每一个函数；</li> <li>Lines: 行覆盖率, 执行到程序中的每一行。</li></ul></li></ul> <blockquote><p>每一个指标都列出了覆盖的比例和数量情况，其中 Statements 与 Lines 比例和数量是一致的，那它们有什么不同呢？
在代码中往往存在一些书写不规范的情况，比如一行多个语句，这个时候它们统计的覆盖率就会有差异。</p></blockquote> <p>每个文件都是可以点击查看具体覆盖情况：</p> <div class="image-view"><div class="image-content image-small"><img alt="测试覆盖率报告" title="测试覆盖率报告" src="/images/autoTesting/007.jpg"> <!----></div></div> <p>因为我们写的测试用例覆盖了当前代码的全部，如果没有的情况下，会出现红色部分和黄色，这代表测试用例没有覆盖。</p> <h3 id="总结"><a href="#总结" aria-hidden="true" class="header-anchor">#</a> 总结</h3> <ul><li>代码覆盖率统计是用来发现没有被测试覆盖的代码</li> <li>代码覆盖率统计不能完全用来衡量代码质量</li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/autoTesting/" class="prev router-link-active">
          介绍
        </a></span> <span class="next"><a href="/autoTesting/skill.html">
          使用技巧
        </a>
        →
      </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.9793175a.js" defer></script><script src="/assets/js/2.57fa4a44.js" defer></script><script src="/assets/js/20.cc05a5ea.js" defer></script><script src="/assets/js/11.1b48c078.js" defer></script><script src="/assets/js/7.5691be78.js" defer></script>
  </body>
</html>
